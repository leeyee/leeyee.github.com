<!DOCTYPE html>
<html>
<head lang="zh-cn">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Begin Jekyll SEO tag v1.3.3 -->
<title>SQL查询语句要点 - Leeyee’s Blog</title>
<meta property="og:title" content="SQL查询语句要点">
<meta name="description" content="本文主要介绍一些SQL语法中有查询操作的要点.主要涉及内外链接查询、合并查询等">
<meta property="og:description" content="本文主要介绍一些SQL语法中有查询操作的要点.主要涉及内外链接查询、合并查询等">
<link rel="canonical" href="http://iyiguo.net/blog/2011/11/17/plsql-sql-select/">
<meta property="og:url" content="http://iyiguo.net/blog/2011/11/17/plsql-sql-select/">
<meta property="og:site_name" content="Leeyee’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2011-11-17T00:00:00+08:00">
<link rel="next" href="http://iyiguo.net/blog/2011/11/18/plsql-sql-comm-func/" title="PL/SQL常用函数">
<link rel="prev" href="http://iyiguo.net/blog/2011/11/16/plsql-sql-groupby/" title="SQL分组语句要点">
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "SQL查询语句要点",
    "datePublished": "2011-11-17T00:00:00+08:00",
    "description": "本文主要介绍一些SQL语法中有查询操作的要点.主要涉及内外链接查询、合并查询等",
    "url": "http://iyiguo.net/blog/2011/11/17/plsql-sql-select/"
  }
</script>
<!-- End Jekyll SEO tag -->
    <link type="application/atom+xml" rel="alternate" href="http://iyiguo.net/feed.xml" title="Leeyee's Blog">
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/myprettify/tomorrow-night-eighties-prettity.css">
    <link rel="stylesheet" href="/stylesheets/self.css">
    
	
 		<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40641589-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
 	
 	
		<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?58361582bf16c265b9a27cec274eb971";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	

</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
    <div class="row">
        <div class="col-md-offset-1">
            <a class="navbar-brand" href="/">Leeyee's Blog</a>
            <ul class="nav navbar-nav ">
                <li>
<a href="/categorys">分类</a>
                </li>
<li>
<a href="/tags">标签</a>
                </li>
<li>
<a href="/archives">归档</a>
                </li>
<li><a href="/essay">essay</a></li>
                <li><a href="/about">关于我</a></li>
            </ul>
            <form class="navbar-form navbar-left" action="https://www.google.com.hk/search" method="get">
                <input type="hidden" name="q" value="site:iyiguo.net">
                <div class="form-group">
                    <input type="text" name="q" class="form-control" placeholder="Search">
                </div>
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-xs-12 col-md-8 col-lg-8">
            <div>
    <ol class="breadcrumb" style="background-color: #F3F8F1; ">
        <li><a href="/">首页</a></li>
        
        <li><a href="/categorys/#SQL">SQL</a></li>
        
        <li class="active">SQL查询语句要点</li>
    </ol>
</div>
<div class="panel panel-primary">
    <div class="panel-heading">
        <h1 class="panel-title self-panel-title"> SQL查询语句要点 </h1>
    </div>
    <div class="panel-body">
        <address class="text-info">
        </address>
        <div id="j_article">
            <div class="alert alert-warning" role="alert">
                <strong>版权声明：</strong>
                <ul>
                    <li>关于<a href="http://iyiguo.net/blog/2011/11/17/plsql-sql-select/">《SQL查询语句要点》</a>的一切权利归作者<a href="mailto:seadlead@gmail.com">@Leeyee</a>所有；</li>
                    <li>非商用、非衍生;</li>
                    <li>如需转载需要注明来源于<a href="http://iyiguo.net/blog/2011/11/17/plsql-sql-select/">http://iyiguo.net/blog/2011/11/17/plsql-sql-select/</a>
</li>
                </ul>
            </div>
            <ul id="markdown-toc">
  <li>
<a href="#section" id="markdown-toc-section">内连接和外连接</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">内连接</a></li>
      <li>
<a href="#section-2" id="markdown-toc-section-2">外连接</a>        <ul>
          <li><a href="#section-3" id="markdown-toc-section-3">左外连接</a></li>
          <li><a href="#section-4" id="markdown-toc-section-4">右外连接</a></li>
          <li><a href="#section-5" id="markdown-toc-section-5">完全外连接</a></li>
          <li><a href="#section-6" id="markdown-toc-section-6">使用<code class="highlighter-rouge">(+)</code>操作符</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<a href="#section-7" id="markdown-toc-section-7">子查询</a>    <ul>
      <li><a href="#section-8" id="markdown-toc-section-8">单行子查询</a></li>
      <li><a href="#section-9" id="markdown-toc-section-9">多行子查询</a></li>
      <li><a href="#section-10" id="markdown-toc-section-10">多列子查询</a></li>
      <li>
<a href="#section-11" id="markdown-toc-section-11">其他子查询</a>        <ul>
          <li><a href="#section-12" id="markdown-toc-section-12">相关子查询</a></li>
          <li><a href="#from" id="markdown-toc-from">在from子句中使用子查询</a></li>
          <li><a href="#dml" id="markdown-toc-dml">在<code class="highlighter-rouge">DML</code>语句中使用子查询</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<a href="#section-13" id="markdown-toc-section-13">合并查询</a>    <ul>
      <li><a href="#union" id="markdown-toc-union">union</a></li>
      <li><a href="#union-all" id="markdown-toc-union-all">union all</a></li>
      <li><a href="#intersect" id="markdown-toc-intersect">intersect</a></li>
      <li><a href="#minus" id="markdown-toc-minus">minus</a></li>
    </ul>
  </li>
  <li>
<a href="#section-14" id="markdown-toc-section-14">其他复杂查询</a>    <ul>
      <li><a href="#section-15" id="markdown-toc-section-15">层次查询</a></li>
      <li><a href="#case" id="markdown-toc-case">case表达式</a></li>
      <li><a href="#with" id="markdown-toc-with">使用with语句重用子查询</a></li>
      <li><a href="#section-16" id="markdown-toc-section-16">倒叙查询</a></li>
    </ul>
  </li>
</ul>

<h2 id="section">内连接和外连接</h2>
<div class="highlighter-rouge">
<pre class="highlight"><code>select table1.column, table2.column
    from table1 [inner | left | rigth | full ] join table2 ON table1.column1 = table2.column2;
</code></pre>
</div>

<h3 id="section-1">内连接</h3>

<p>内连接用于返回满足连接条件的所有记录；默认情况下，在执行连接查询时如果没有指定任何连接操作符，那么这些连接查询都属于内连接。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select a.dname,b.ename from department a, employee b where a.deptNo = b.deptNo;
</code></pre>
</div>

<p>或者</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select a.dame,b.ename from department a inner join employee b ON a.deptNo = b.deptNo;
</code></pre>
</div>

<p><span class="label label-important"><em>NOTES：</em></span></p>

<p>从Ooracle9i开始，如果主表主键列和从表外键列名称相同，那么还可以使用<code class="highlighter-rouge">natural join</code>关键字自动执行内连接</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select dname,ename from department natrual join employee;
</code></pre>
</div>

<h3 id="section-2">外连接</h3>

<p>外连接是内连接的扩展，不仅会返回满足连接条件的所有记录，还会返回不满足连接条件的记录。</p>

<h4 id="section-3">左外连接</h4>

<p>左外连接通过<code class="highlighter-rouge">left [outer] join</code>实现。左外连接返回满足连接条件的记录，同时返回不满足条件的连接操作符左边表的其他行。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select a.dname, b.ename from department a left join employee b on a.deptno = b.deptno;
    
	dname       ename
	------		-------
	test		king
	test 		king2
	test1				
	test2
</code></pre>
</div>

<h4 id="section-4">右外连接</h4>

<p>右外连接通过<code class="highlighter-rouge">rigth [outer] join</code>实现。右外连接返回满足连接条件的记录，同时返回不满足条件的连接操作符右边表的其他行。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select a.dname, b.ename from department a right join employee b on a.deptno = b.deptno;
    
	dname       ename
	------		-------
	test		king
	test 		king2
				king3
				king4
</code></pre>
</div>

<h4 id="section-5">完全外连接</h4>

<p>完全外连接通过<code class="highlighter-rouge">full [outer] join</code>实现。完全外连接时左外连接和右外连接的结合。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select a.dname, b.ename from department a full join employee b on a.deptno = b.deptno;
    
	dname       ename
	------		-------
	test		king
	test 		king2
	test1
	test2
				king3
				king4		
</code></pre>
</div>

<h4 id="section-6">使用<code class="highlighter-rouge">(+)</code>操作符</h4>

<p>Oracle9i前使用<code class="highlighter-rouge">(+)</code>操作符。Oracle9i后建议使用<code class="highlighter-rouge">outer join</code>执行外连接。语法如下：</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>select table1.column, table2.column 
    from table1, table2 
        where table1.column1(+) = table2.column2;
</code></pre>
</div>

<p>当使用<code class="highlighter-rouge">(+)</code>操作符时，应该将该操作符放在显示较少行（完全满足连接条件）的一端。</p>

<p><span class="label label-important"><em>NOTES：</em></span></p>

<ol>
  <li>
<code class="highlighter-rouge">(+)</code>操作符只出现在<code class="highlighter-rouge">where</code>子句中，并且不能同<code class="highlighter-rouge">OUTER JOIN</code>语法同用;</li>
  <li>当使用<code class="highlighter-rouge">(+)</code>操作符执行外连接时，如果<code class="highlighter-rouge">where</code>子句中包含多个条件，则必须所有条件中都包含<code class="highlighter-rouge">(+)</code>操作符;</li>
  <li>
<code class="highlighter-rouge">(+)</code>操作符只适用于列，不能用在表达式上;</li>
  <li>
<code class="highlighter-rouge">(+)</code>操作符不能与<code class="highlighter-rouge">or</code>和<code class="highlighter-rouge">in</code>操作符一起使用;</li>
  <li>
    <p><code class="highlighter-rouge">(+)</code>操作符只能实现左外、右外连接，不能实现完全连接;</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> 2.1 左外连接示例可写成
 SQL&gt; select a.dname, b.ename from department a, employee b where a.deptno = b.deptno(+);
        
 2.2 右外连接示例可写成
 SQL&gt; select a.dname, b.ename from department a, employee b where a.deptno(+) = b.deptno;
</code></pre>
    </div>
  </li>
</ol>

<h2 id="section-7">子查询</h2>

<h3 id="section-8">单行子查询</h3>

<p>只返回一行数据的子查询语句。当在<code class="highlighter-rouge">where</code>中引用单行子查询时，可以使用单行比较符 =,&gt;,&lt;,&gt;=,&lt;=,&lt;&gt;</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename, salary, deptno from employee where deptno = 
SQL&gt; (select deptno from employee where ename = 'scott');
</code></pre>
</div>

<h3 id="section-9">多行子查询</h3>

<p>返回多行数据的子查询语句。当在<code class="highlighter-rouge">where</code>中引用多行子查询时，必须要使用如下多行比较符:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">in</code> : 匹配于子查询结果的任一个值即可</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>  SQL&gt; select ename,job,sal,deptno from emp where job in
  SQL&gt; (select distinct job from emp where deptno = 10);
</code></pre>
    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">all</code> : 必须要符合子查询结果的所有值</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>  SQL&gt; select ename,job,sal,deptno from emp where sal &gt; all
  SQL&gt; (select sal from emp where deptno = 10);
</code></pre>
    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">any</code> : 只要符合子查询结果的任一个值即可</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>  SQL&gt; select ename,job,sal,deptno from emp where sal &gt; any
  SQL&gt; (select sal from emp where deptno = 10);	
</code></pre>
    </div>
  </li>
</ul>

<h3 id="section-10">多列子查询</h3>

<p>多列子查询返回多列数据的子查询语句。</p>

<ul>
  <li>当多列子查询返回单行数据时，<code class="highlighter-rouge">where</code>中可以使用单行比较符；</li>
  <li>当多列子查询返回多行数据时，<code class="highlighter-rouge">where</code>中必须使用多行比较符；</li>
  <li>
    <p>当使用子查询比较多列数据时，即可以成对比较也可以非成对比较。成对比较要求多个列的数据必须同时匹配，非成对则不要求。</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>  -- 成对比较示例
      SQL&gt; select ename, sal, comm, deptno from emp
      SQL&gt; where (sal, nvl(comm,-1) in
      SQL&gt; (select sal, nvl(comm,-1) from emp where deptno = 10 );

  -- 非成对比较示例.执行非成对比较，应使用多个多行子查询实现
      SQL&gt; select ename, sal, comm, deptno from emp
      SQL&gt; where sal in
      SQL&gt; (select sal from emp where deptno = 30 )
      SQL&gt; and nvl(comm,-1) in
      SQL&gt; (select nvl(comm,-1) from emp where deptno = 30);
</code></pre>
    </div>
  </li>
</ul>

<h3 id="section-11">其他子查询</h3>

<h4 id="section-12">相关子查询</h4>

<p>相关子查询是指需要引用主查询表列的子查询语句，相关子查询是通过<code class="highlighter-rouge">exists</code> 谓词实现的。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename, sal, job, depton from emp where exists
SQL&gt; (select 1 from dept where dept.depton = emp.depton );
</code></pre>
</div>

<p><span class="label label-important"><em>NOTES：</em></span><br>
当使用<code class="highlighter-rouge">exists</code>谓词时，如果子查询存在返回结果，则条件为<code class="highlighter-rouge">TRUE</code>; 如果子查询没有返回结果，则条件为<code class="highlighter-rouge">FALSE</code></p>

<h4 id="from">在from子句中使用子查询</h4>

<p><code class="highlighter-rouge">from</code>中的子查询会被当作视图对待，因此也被称作内嵌视图。</p>

<p><span class="label label-important"><em>NOTES：</em></span><br>
<code class="highlighter-rouge">from</code>子句中使用子查询时，必须要给子查询指定别名</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename, job, sal, from emp, 
SQL&gt; (select deptno, avg(sal) avgsal from emp group by deptno) dept 
SQL&gt; where emp.deptno = deptno and sal &gt; dept.avgsal;
</code></pre>
</div>

<h4 id="dml">在<code class="highlighter-rouge">DML</code>语句中使用子查询</h4>

<ol>
  <li>
    <p>在<code class="highlighter-rouge">insert</code>语句中使用子查询</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> SQL&gt; insert into customer(name,age) select name,age from employee where eno = 200;
</code></pre>
    </div>
  </li>
  <li>
    <p>在<code class="highlighter-rouge">update</code>语句中使用子查询</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> SQL&gt; update emp set (sal, comm) = 
 SQL&gt; (select sal, comm from emp where ename = 'jack')
 SQL&gt; where job = (select job from emp where ename = 'jack');
</code></pre>
    </div>
  </li>
  <li>
    <p>在<code class="highlighter-rouge">delete</code>语句中使用子查询</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> SQL&gt; delete emp where deptno = 
 SQL&gt; (select deptno from dept where dname = 'jack');
</code></pre>
    </div>
  </li>
  <li>
    <p>在<code class="highlighter-rouge">DDL</code>语句中使用子查询</p>

    <ul>
      <li>
        <p>在<code class="highlighter-rouge">create table</code>语句中使用</p>

        <p>使用子查询可以在建立新表的同时复制表中的数据</p>

        <div class="highlighter-rouge">
<pre class="highlight"><code>  SQL&gt; create table new_emp (id, name, sal, job) as
  SQL&gt; select empno,ename,esal,ejob from emp;
</code></pre>
        </div>
      </li>
      <li>
        <p>在<code class="highlighter-rouge">create view</code>中使用</p>

        <p>创建视图时必须要指定视图所对应的子查询语句</p>

        <div class="highlighter-rouge">
<pre class="highlight"><code>  SQL&gt; create or replace view dept_10 as
  SQL&gt; SELECT empno,ename,esal,ejob FROM emp ORDER BY empno;
</code></pre>
        </div>
      </li>
      <li>
        <p>在<code class="highlighter-rouge">create materialized view</code>中使用</p>

        <p>创建<a href="http://docs.oracle.com/cd/E11882_01/server.112/e17118/statements_6002.htm" title="materialized view">实体化视图</a>时，必须要指定实体化视图所对应的SQL语句，并且该SQL语句将来可用于查询重写。</p>

        <div class="highlighter-rouge">
<pre class="highlight"><code>  SQL&gt; create materialized view summary_emp as
  SQL&gt; select deptno, job, avg(sal) avasal, sum(sal) sumsal 
  SQL&gt; from emp group by cube(deptno, job);
</code></pre>
        </div>
      </li>
    </ul>
  </li>
</ol>

<h2 id="section-13">合并查询</h2>

<div class="highlighter-rouge">
<pre class="highlight"><code>select 语句1 [union | union all | intersect | minus] select 语句2
</code></pre>
</div>

<ol>
  <li>这些集合操作符具有相同的优先级。同时使用时会按照从左至右的方式引用这些集合操作符</li>
  <li>使用集合操作符时，必须确保不同查询的列个数和数据类型都要匹配</li>
  <li>对于<code class="highlighter-rouge">lob</code>、<code class="highlighter-rouge">varray</code>和嵌套表列来说，集合操作符无效</li>
  <li>对于<code class="highlighter-rouge">long</code>列来说，<code class="highlighter-rouge">union</code>、<code class="highlighter-rouge">intersect</code>、<code class="highlighter-rouge">minus</code>操作无效</li>
  <li>如果选择列表包含了表达式，则必须要为其指定列别名</li>
</ol>

<h3 id="union">union</h3>

<p>合并结果集，并会自动去掉结果集中的重复行，并且会以第一列的结果进行排序</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename,sal,job from emp where sal &gt; 2500
SQL&gt; union
SQL&gt; select ename,sal,job from emp where job = 'manager';
</code></pre>
</div>

<h3 id="union-all">union all</h3>

<p>合并结果集，但不会去掉结果集中的重复行，也不会进行任何排序，只是简单的做合并</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename,sal,job from emp where sal &gt; 2500
SQL&gt; union all
SQL&gt; select ename,sal,job from emp where job = 'manager';
</code></pre>
</div>

<h3 id="intersect">intersect</h3>

<p>获取两个结果集的交集，并以第一列的结果进行排序</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename,sal,job from emp where sal &gt; 2500
SQL&gt; intersect
SQL&gt; select ename,sal,job from emp where job = 'manager';
</code></pre>
</div>

<h3 id="minus">minus</h3>

<p>获取两个结果集的差集。只显示在第一个结果集中存在，在第二结果集中不存在的数据，并以第一列的结果进行排序</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename,sal,job from emp where sal &gt; 2500
SQL&gt; minus
SQL&gt; select ename,sal,job from emp where job = 'manager';
</code></pre>
</div>

<h2 id="section-14">其他复杂查询</h2>

<h3 id="section-15">层次查询</h3>

<p>当表具有层次结构时，使用层次查询可以更直观的显示数据结果，并显示其数据之间的层次关系</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>select 语句 start with condition connect by condition
</code></pre>
</div>

<ul>
  <li>
<code class="highlighter-rouge">start with</code>: 用于指定层次查询的根行。</li>
  <li>
<code class="highlighter-rouge">connect by</code>: 用户指定父行和子行之间的关系。</li>
</ul>

<p>在condition表达式中，必须使用<code class="highlighter-rouge">prior</code>引用父行。语法如下：</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>... prior expr = expr 或者 ... expr = prior expr
</code></pre>
</div>

<p>假如emp表具层次结构，其中empno列对应雇员号，而mgr列对应管理者编号。那么通过层次查询，可以显示雇员之间的上下级关系。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; col ename format a15
SQL&gt; col job format a15
SQL&gt; select lpad(' ', 3 * (level-1))||ename ename,
SQL&gt; lpad(' ', 3 * (level-1))||job job from emp
SQL&gt; where job &lt;&gt; 'clean' start with mgr is null
SQL&gt; connect by mgr = prior empno;
</code></pre>
</div>

<h3 id="case">case表达式</h3>

<p>为了在 SQL 语句中使用 <code class="highlighter-rouge">if..then..else</code>语法，可以使用 <code class="highlighter-rouge">case</code>表达式。当使用<code class="highlighter-rouge">case</code>表达式时，可以使用 <code class="highlighter-rouge">where</code>子句指定条件语句。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; select ename, sal,
SQL&gt; case when sal &gt; 3000 then 3
SQL&gt; when sal &gt;  2000 then 2
SQL&gt; else 1 end grade
SQL&gt; from emp where deptno = 10;
</code></pre>
</div>

<h3 id="with">使用with语句重用子查询</h3>

<p>Oracle9i开始，通过<code class="highlighter-rouge">with</code>子句可以给子查询指定一个名称，并且使得在一条语句中可以完成所有任务，避免使用临时表</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>SQL&gt; with summary as (
SQL&gt; 	select dname, sum(sal) as dept_total from emp,dept
SQL&gt; 	where emp.deptno = dept.deptno group by dname
SQL&gt; )
SQL&gt; select dname, dept_total from summary where dept_total &gt; 
SQL&gt; ( select sum(dept_total) * 1/3 from summary);
</code></pre>
</div>

<h3 id="section-16">倒叙查询</h3>

<p>默认情况下执行查询操作只能看到最近提交的数据。从Oracle9i开始，通过使用倒叙查询(<a href="http://docs.oracle.com/cd/E11882_01/appdev.112/e25518/adfns_flashback.htm" title="Flashback Query">Flashback Query</a>)特征，可以查看到过去某个时间点所提交的数据。</p>

<p><span class="label label-important"><em>NOTES：</em></span><br>
使用倒叙查询，要求数据库必须采用<code class="highlighter-rouge">undo</code>管理方式，并且初始化参数<code class="highlighter-rouge">undo_retention</code>限制了<code class="highlighter-rouge">undo</code>数据的保留时间。</p>

<ol>
  <li>
    <p>查看当前数据</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> SQL&gt; select ename, sal from emp where ename = 'jack';
</code></pre>
    </div>
  </li>
  <li>
    <p>查看历史数据</p>

    <p>执行倒叙查询时，通过在<code class="highlighter-rouge">from</code>子句后指定<code class="highlighter-rouge">as of</code>子句可以查看过去的历史数据。<code class="highlighter-rouge">as of</code>中既可以指定时间，也可以指定SCN.</p>

    <p><span class="label label-important"><em>NOTES：</em></span><br>
 使用倒叙查询只能看到5分钟之前变化数据。</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> SQL&gt; select ename, sal from emp as of timestamp to_timestamp('2011-10-12 16:00:00','yyyy-MM-dd hh24:mi:ss')
 SQL&gt; where ename = 'jack';
</code></pre>
    </div>
  </li>
  <li>
    <p>使用<code class="highlighter-rouge">dbms_flashback</code>包获取特定<code class="highlighter-rouge">SCN</code>的数据</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> SQL&gt; exec dbms_flashback.enable_at_system_change_number(717402);
 SQL&gt; select sal from emp where ename = 'jack';
 SQL&gt; exec dbms_flashback.disable;
 SQL&gt; select sal from emp where ename = 'jack';
</code></pre>
    </div>
  </li>
</ol>


        </div>
        <div class="alert alert-info" role="alert">
            <strong>相关阅读：</strong>
            <ul>
                                                                             
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2015/08/30/plsql-sql-use-sql-in-block/">PL/SQL块中使用SQL</a></li>
                   
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2015/08/30/plsql-control-statement/">PL/SQL流程控制语言</a></li>
                   
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2015/08/30/plsql-complex-data-type/">PL/SQL复合数据类型</a></li>
                                                                   
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2011/11/18/plsql-sql-comm-func/">PL/SQL常用函数</a></li>
                   
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2011/11/17/plsql-sql-select/">SQL查询语句要点</a></li>
                   
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2011/11/16/plsql-sql-groupby/">SQL分组语句要点</a></li>
                  
            </ul>
        </div>
    </div>
    <div class="panel-footer">
        <span class="glyphicon glyphicon-calendar"></span>
        
        <a href="/archives/#2011-11">2011年11月17日</a>
        
        <span class="glyphicon glyphicon-user"></span>
         leeyee 
        
        <span class="glyphicon glyphicon-folder-close"></span>
        <a href="/categorys/#SQL"> SQL</a>
        
         <span class="glyphicon glyphicon-tags"></span> pl/sql 
    </div>
</div>
<div class="panel panel-default">
    <div class="panel-body">
        <div class="pull-right">
	
		<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_24x24">
     <a class="jiathis_button_tsina"></a>
     <a class="jiathis_button_qzone"></a>
     <a class="jiathis_button_tqq"></a>
     <a class="jiathis_button_renren"></a>
     <a class="jiathis_button_t163"></a>
     <a class="jiathis_button_tsohu"></a>
     <a class="jiathis_button_douban"></a>
     <!--<a href="http://www.jiathis.com/share?uid=1785947" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>-->
     <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1354586152725188" charset="utf-8"></script>
<!-- JiaThis Button END -->
	
</div>
        <div>
	
			<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'oxcow'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script');
		dsq.type = 'text/javascript';
		dsq.async = true;
		dsq.src = 'https://a.disquscdn.com/embed.js';
		//dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document
				.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span
	class="logo-disqus">Disqus</span></a>-->
		

	</div>
    </div>
</div>
        </div>
        <div class="col-xs-6 col-md-4 col-lg-4">
            <div class="panel panel-default">
                <div class="panel-body">
                    <a href="/feed.xml"><img src="/img/rss.png" class="self-img-40">RSS 本站</a>
                </div>
            </div>
            <!-- 本站公告 -->
            <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">本站公告</h2>
    </div>
    <div class="panel-body">
        新版页面陆续建设中，敬请期待......
    </div>
</div>
            <!-- Google Adsense -->
            <!--<div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">Google Adsense</h2>
    </div>
    <div class="panel-body">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-3709356780361184"
            data-ad-slot="2345263955"
            data-ad-format="auto"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
</div>
-->
            <!-- 最新文章 -->
            <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">最新文章</h2>
    </div>
    <div class="list-group">
<!--        <a  class="list-group-item active">最新文章</a>-->
        
        <a href="/blog/2016/11/06/stripes-how-to-wizard_forms/" class="list-group-item">Stripes框架如何做系列-向导表单</a>
        
        <a href="/blog/2016/09/15/stripes-how-to-use_defaults_more/" class="list-group-item">Stripes框架如何做系列-更多使用默认配置</a>
        
        <a href="/blog/2016/09/10/stripes-how-to-unit_testing/" class="list-group-item">Stripes框架如何做系列-单元测试</a>
        
        <a href="/blog/2016/08/25/stripes-how-to-state_management/" class="list-group-item">Stripes框架如何做系列-状态管理</a>
        
        <a href="/blog/2016/08/21/stripes-how-to-localization/" class="list-group-item">Stripes框架如何做系列-本地化</a>
        
        <a href="/blog/2016/08/03/stripes-how-to-spring-with-stripes/" class="list-group-item">Stripes框架如何做系列-Spring和Stripes</a>
        
        <a href="/blog/2016/07/22/stripes-how-to-indexed-properties/" class="list-group-item">Stripes框架如何做系列-索引属性</a>
        
        <a href="/blog/2016/07/17/stripes-how-to-layout-reuse/" class="list-group-item">Stripes框架如何做系列-布局复用</a>
        
        <a href="/blog/2016/07/16/stripes-how-to-intercept-execution/" class="list-group-item">Stripes框架如何做系列-拦截器</a>
        
        <a href="/blog/2016/07/13/stripes-how-to-file-uploads/" class="list-group-item">Stripes框架如何做系列-文件上传</a>
        
    </div>
</div>

            <!-- 文章标签 -->
            <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">文章标签</h2>
    </div>
    <div class="list-group">
       <!-- <a  class="list-group-item active">文章标签</a>-->
        
        <a href="/tags#javascript" class="list-group-item">javascript<span class="badge">9</span></a>
        
        <a href="/tags#struts2" class="list-group-item">struts2<span class="badge">1</span></a>
        
        <a href="/tags#jQuery" class="list-group-item">jQuery<span class="badge">4</span></a>
        
        <a href="/tags#spring" class="list-group-item">spring<span class="badge">3</span></a>
        
        <a href="/tags#%E8%AF%91%E6%96%87" class="list-group-item">译文<span class="badge">18</span></a>
        
        <a href="/tags#pl/sql" class="list-group-item">pl/sql<span class="badge">8</span></a>
        
        <a href="/tags#mybatis" class="list-group-item">mybatis<span class="badge">4</span></a>
        
        <a href="/tags#database" class="list-group-item">database<span class="badge">1</span></a>
        
        <a href="/tags#hibernate" class="list-group-item">hibernate<span class="badge">1</span></a>
        
        <a href="/tags#cache" class="list-group-item">cache<span class="badge">1</span></a>
        
        <a href="/tags#git" class="list-group-item">git<span class="badge">2</span></a>
        
        <a href="/tags#java" class="list-group-item">java<span class="badge">1</span></a>
        
        <a href="/tags#awk" class="list-group-item">awk<span class="badge">2</span></a>
        
        <a href="/tags#linux" class="list-group-item">linux<span class="badge">3</span></a>
        
        <a href="/tags#stripes" class="list-group-item">stripes<span class="badge">15</span></a>
        
    </div>
</div>
            <div class="row">
                <div class="col-xs-12 col-md-6 col-lg-6">
                    <!-- 归档 -->
                    <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">归档</h2>
    </div>
    <div class="panel-body">
        <ul class="nav nav-list">
            
            
             
            <li>
<a href="/archives#2016-11">2016-11
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-09">2016-09
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
            
             
            <li>
<a href="/archives#2016-08">2016-08
                
                
                <span class="badge">3</span></a>
            </li>
            
            
            
            
            
            
             
            <li>
<a href="/archives#2016-07">2016-07
                
                
                <span class="badge">9</span></a>
            </li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
             
            <li>
<a href="/archives#2016-04">2016-04
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-03">2016-03
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-02">2016-02
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-01">2016-01
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
            
             
            <li>
<a href="/archives#2015-08">2015-08
                
                
                <span class="badge">5</span></a>
            </li>
            
            
            
            
            
            
            
            
            
            
             
            <li>
<a href="/archives#2015-07">2015-07
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2014-05">2014-05
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2013-11">2013-11
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2013-08">2013-08
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2013-07">2013-07
                
                
                <span class="badge">3</span></a>
            </li>
            
            
            
            
            
            
             
            <li>
<a href="/archives#2013-05">2013-05
                
                
                <span class="badge">3</span></a>
            </li>
            
            
            
            
            
            
             
            <li>
<a href="/archives#2012-12">2012-12
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2012-09">2012-09
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2012-05">2012-05
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
            
             
            <li>
<a href="/archives#2011-11">2011-11
                
                
                <span class="badge">5</span></a>
            </li>
            
            
            
            
            
            
            
            
            
            
             
            <li>
<a href="/archives#2011-06">2011-06
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2011-04">2011-04
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2010-04">2010-04
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2009-09">2009-09
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2009-08">2009-08
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
        </ul>
    </div>
</div>
                </div>
                <div class="col-xs-12 col-md-6 col-lg-6">
                    <!-- 文章分类 -->
                    <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">文章分类</h2>
    </div>
    <div class="panel-body">
        <ul class="nav nav-list">
            
            <li>
                <a href="/categorys#javascript">javascript<sup style="padding-left: 4px">6</sup></a>
            </li>
            
            <li>
                <a href="/categorys#struts2">struts2<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#spring">spring<sup style="padding-left: 4px">3</sup></a>
            </li>
            
            <li>
                <a href="/categorys#SQL">SQL<sup style="padding-left: 4px">8</sup></a>
            </li>
            
            <li>
                <a href="/categorys#jQuery">jQuery<sup style="padding-left: 4px">3</sup></a>
            </li>
            
            <li>
                <a href="/categorys#mybatis">mybatis<sup style="padding-left: 4px">4</sup></a>
            </li>
            
            <li>
                <a href="/categorys#database">database<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#hibernate">hibernate<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#git">git<sup style="padding-left: 4px">2</sup></a>
            </li>
            
            <li>
                <a href="/categorys#java">java<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80">脚本语言<sup style="padding-left: 4px">2</sup></a>
            </li>
            
            <li>
                <a href="/categorys#%E5%85%B6%E4%BB%96">其他<sup style="padding-left: 4px">3</sup></a>
            </li>
            
            <li>
                <a href="/categorys#stripes">stripes<sup style="padding-left: 4px">15</sup></a>
            </li>
            
        </ul>
    </div>
</div>
                </div>
            </div>
        </div>
    </div>
</div>
<hr>
<footer>
    <p class="text-center">©2016 by Leeyee, All Rights Reserved</p>
</footer>
<!--<script type="text/javascript" src="/js/MathJax.js"></script>-->
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
    !window.jQuery && document.write('<script src="/js/jquery-1.11.1.min.js"><\/script>');
</script>
<script type="text/javascript" src="/js/common.js"></script>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="http://apps.bdimg.com/libs/html5shiv/r29/html5.min.js"></script>
<script src="http://apps.bdimg.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<div id="totop" class="toTop" style="display: block; opacity: 1;">
    <button type="button" class="btn btn-info btn-lg">Top<span class="glyphicon glyphicon-plane"></span></button>
</div>
</body>
</html>
