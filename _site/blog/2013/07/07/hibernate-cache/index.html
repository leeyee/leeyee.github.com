<!DOCTYPE html>
<html>
<head lang="zh-cn">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Begin Jekyll SEO tag v1.3.3 -->
<title>Hibernate缓存 - Leeyee’s Blog</title>
<meta property="og:title" content="Hibernate缓存">
<meta name="description" content="本文介绍了相关hibernate缓存的知识以及缓存配置时关于并发事务级别的相关知识。同时结合hibernate annotation的@Cache注解标签，实际演示了如何使用注解配置hibernate缓存。">
<meta property="og:description" content="本文介绍了相关hibernate缓存的知识以及缓存配置时关于并发事务级别的相关知识。同时结合hibernate annotation的@Cache注解标签，实际演示了如何使用注解配置hibernate缓存。">
<link rel="canonical" href="http://iyiguo.net/blog/2013/07/07/hibernate-cache/">
<meta property="og:url" content="http://iyiguo.net/blog/2013/07/07/hibernate-cache/">
<meta property="og:site_name" content="Leeyee’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-07-07T00:00:00+08:00">
<link rel="next" href="http://iyiguo.net/blog/2013/07/31/javascript-idcard-validate/" title="javascript身份证号码验证">
<link rel="prev" href="http://iyiguo.net/blog/2013/07/04/database-transaction-concurrency/" title="数据库事务与并发">
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Hibernate缓存",
    "datePublished": "2013-07-07T00:00:00+08:00",
    "description": "本文介绍了相关hibernate缓存的知识以及缓存配置时关于并发事务级别的相关知识。同时结合hibernate annotation的@Cache注解标签，实际演示了如何使用注解配置hibernate缓存。",
    "url": "http://iyiguo.net/blog/2013/07/07/hibernate-cache/"
  }
</script>
<!-- End Jekyll SEO tag -->
    <link type="application/atom+xml" rel="alternate" href="http://iyiguo.net/feed.xml" title="Leeyee's Blog">
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/myprettify/tomorrow-night-eighties-prettity.css">
    <link rel="stylesheet" href="/stylesheets/self.css">
    
	
 		<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40641589-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
 	
 	
		<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?58361582bf16c265b9a27cec274eb971";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	

</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
    <div class="row">
        <div class="col-md-offset-1">
            <a class="navbar-brand" href="/">Leeyee's Blog</a>
            <ul class="nav navbar-nav ">
                <li>
<a href="/categorys">分类</a>
                </li>
<li>
<a href="/tags">标签</a>
                </li>
<li>
<a href="/archives">归档</a>
                </li>
<li><a href="/essay">essay</a></li>
                <li><a href="/about">关于我</a></li>
            </ul>
            <form class="navbar-form navbar-left" action="https://www.google.com.hk/search" method="get">
                <input type="hidden" name="q" value="site:iyiguo.net">
                <div class="form-group">
                    <input type="text" name="q" class="form-control" placeholder="Search">
                </div>
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-xs-12 col-md-8 col-lg-8">
            <div>
    <ol class="breadcrumb" style="background-color: #F3F8F1; ">
        <li><a href="/">首页</a></li>
        
        <li><a href="/categorys/#hibernate">hibernate</a></li>
        
        <li class="active">Hibernate缓存</li>
    </ol>
</div>
<div class="panel panel-primary">
    <div class="panel-heading">
        <h1 class="panel-title self-panel-title"> Hibernate缓存 </h1>
    </div>
    <div class="panel-body">
        <address class="text-info">
        </address>
        <div id="j_article">
            <div class="alert alert-warning" role="alert">
                <strong>版权声明：</strong>
                <ul>
                    <li>关于<a href="http://iyiguo.net/blog/2013/07/07/hibernate-cache/">《Hibernate缓存》</a>的一切权利归作者<a href="mailto:seadlead@gmail.com">@Leeyee</a>所有；</li>
                    <li>非商用、非衍生;</li>
                    <li>如需转载需要注明来源于<a href="http://iyiguo.net/blog/2013/07/07/hibernate-cache/">http://iyiguo.net/blog/2013/07/07/hibernate-cache/</a>
</li>
                </ul>
            </div>
            <ul id="markdown-toc">
  <li>
<a href="#section" id="markdown-toc-section">持久化层缓存的范围</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">事务范围</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">进程范围</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">群集范围</a></li>
    </ul>
  </li>
  <li>
<a href="#section-4" id="markdown-toc-section-4">持久化层缓存的并发访问策略</a>    <ul>
      <li><a href="#section-5" id="markdown-toc-section-5">事务型</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">读写型</a></li>
      <li><a href="#section-7" id="markdown-toc-section-7">非严格读写型</a></li>
      <li><a href="#section-8" id="markdown-toc-section-8">只读型</a></li>
      <li><a href="#section-9" id="markdown-toc-section-9">应用场景</a></li>
    </ul>
  </li>
  <li><a href="#hibernate" id="markdown-toc-hibernate">Hibernate一级缓存</a></li>
  <li>
<a href="#hibernate-1" id="markdown-toc-hibernate-1">Hibernate二级缓存</a>    <ul>
      <li><a href="#section-10" id="markdown-toc-section-10">二级缓存的开启</a></li>
    </ul>
  </li>
  <li>
<a href="#hibernate-2" id="markdown-toc-hibernate-2">Hibernate查询缓存</a>    <ul>
      <li><a href="#section-11" id="markdown-toc-section-11">查询缓存的配置</a></li>
    </ul>
  </li>
  <li>
<a href="#section-12" id="markdown-toc-section-12">与缓存有关的注解</a>    <ul>
      <li><a href="#entity" id="markdown-toc-entity">@Entity</a></li>
      <li>
<a href="#cache" id="markdown-toc-cache">@Cache</a>        <ul>
          <li><a href="#section-13" id="markdown-toc-section-13">缓存实体</a></li>
          <li><a href="#section-14" id="markdown-toc-section-14">缓存集合</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#section-15" id="markdown-toc-section-15">比较完整的例子</a></li>
</ul>

<p>Hibernate中实现缓存的对象有<code class="highlighter-rouge">Session</code>和<code class="highlighter-rouge">SessionFactory</code>。</p>

<p><code class="highlighter-rouge">Session</code>的缓存为内置缓存，不可被卸载，称为Hibernate的一级缓存；</p>

<p><code class="highlighter-rouge">SessionFactory</code>有一个内置缓存和一个外置缓存。其中外置缓存可插拔，被称作Hibernate的二级缓存。</p>

<p><strong>Note:</strong>  Hibernate的这两级缓存均位于<strong>持久化层</strong>，存放的都是数据库数据的拷贝。</p>

<h2 id="section">持久化层缓存的范围</h2>

<p>持久化层缓存的范围可分为三类：事务范围、进程范围及群集范围。</p>

<p>事务范围的缓存是持久化层的第一级缓存，通常是必须的；进程范围或群集范围的缓存是持久化层的第二级缓存，通常是可选的。</p>

<p><strong>对于是否应用群集范围的缓存应慎重考虑，因为有时它未必能提高应用性能。</strong></p>

<h3 id="section-1">事务范围</h3>

<ol>
  <li>
    <p>缓存只能被当前事务访问。</p>
  </li>
  <li>
    <p>其生命周期依赖于事务的生命周期，事务结束，缓存也就结束；</p>
  </li>
  <li>
    <p>缓存的物理介质为内存；</p>
  </li>
  <li>
    <p>这里的事务是数据库事务或应用事务。每个事务都有其独自的缓存，缓存内的数据通常采用相互关联的对象形式。</p>
  </li>
</ol>

<h3 id="section-2">进程范围</h3>

<ol>
  <li>
    <p>缓存被进程内的所有事务共享。这些事物可并发访问混存，因此需要相应的事务隔离机制；</p>
  </li>
  <li>
    <p>其生命周期依赖于进程的生命周期；</p>
  </li>
  <li>
    <p>缓存的介质为内存或者硬盘；</p>
  </li>
  <li>
    <p>缓存内的数据既可采用相互关联的对象形式，也可采用对对象的散装数据形式，散装数据形式类似对象的序列化。</p>
  </li>
</ol>

<h3 id="section-3">群集范围</h3>

<ol>
  <li>
    <p>缓存被同一个机器或多个机器上的多个进程共享；</p>
  </li>
  <li>
    <p>缓存被复制到群集环境中的每个进程节点，进程之间通过远程通讯保证缓存中的数据一致；</p>
  </li>
  <li>
    <p>缓存中的数据通常采用对象的散装数据形式。</p>
  </li>
</ol>

<h2 id="section-4">持久化层缓存的并发访问策略</h2>

<h3 id="section-5">事务型</h3>

<p>仅在受管理环境中使用。提供<strong>可重复读<a href="/blog/2013/07/04/database-transaction-concurrency/" title="数据库事务与并发">事务隔离级别</a></strong> 。可用于经常读但很少被修改的数据，因为他<strong>可防止脏读和不可重复读</strong>。</p>

<h3 id="section-6">读写型</h3>

<p>提供<strong>读已提交数据<a href="/blog/2013/07/04/database-transaction-concurrency/" title="数据库事务与并发">事务隔离级别</a></strong>。仅在非群集环境中适用，可用于经常度但很少被修改的数据，因为他<strong>可防止读脏数据</strong> 。</p>

<h3 id="section-7">非严格读写型</h3>

<p>不保证缓存与数据库中数据的一致性。如果存在两个事务同时访问缓存中相同的数据，必须为该数据配置一个很短的过期时间，避免脏读。对于允许偶尔脏读的数据，可以采用该策略。</p>

<h3 id="section-8">只读型</h3>

<p>可用于从来不会被修改的数据，如参考数据等。</p>

<h3 id="section-9">应用场景</h3>

<p>事务型并发访问策略的<a href="/blog/2013/07/04/database-transaction-concurrency/" title="数据库事务与并发">事务隔离级别</a>最高，只读型最低。<strong>隔离级别越低，并发性能越好</strong>。</p>

<ol>
  <li>
    <p>一般符合以下条件的数据才适合存放在二级缓存中：</p>

    <ul>
      <li>很少被修改的数据；</li>
      <li>不是很重要的数据，允许出现偶尔的并发问；</li>
      <li>不会被并发访问的数据；</li>
      <li>参考数据（常量数据）。</li>
    </ul>

    <p>其中，参考数据具有以下特点：</p>

    <ul>
      <li>实例数目有限；</li>
      <li>每个实例会被许多其他类的实例引用；</li>
      <li>实例极少或者从来不被修改。</li>
    </ul>
  </li>
  <li>
    <p>不适合存放于二级缓存中的数据</p>

    <ul>
      <li>经常被修改的数据；</li>
      <li>财务数据，绝对不允许出现并发问题；</li>
      <li>与其他应用共享的数据。因为当使用Hibernate二级缓存与其他应用共享数据库的某种数据时，如果其他应用修改了数据中的数据，Hibernate将无法保证二级缓存中的数据与数据库保持一致。</li>
    </ul>
  </li>
</ol>

<h2 id="hibernate">Hibernate一级缓存</h2>

<p>Hibernate一级缓存中存放的数据是数据库中数据的拷贝，其表现为相互关联的实体对象。<code class="highlighter-rouge">Session</code>会在某些时间点按照缓存中的数据来同步更新数据库，这一个过程称作清理缓存。</p>

<p>当应用程序调用 Session 的 save(),update(),saveOrUpdate(),load(),get(),find()以及查询接口的 list(),iterate() 或者 filter() 方法时，如果Session 的缓存中不存在相应的对象，Hibernate就会把该对象加入到一级缓存中。</p>

<p>可通过以下两个方法管理缓存：</p>

<ul>
  <li>
<code class="highlighter-rouge">evict(object o)</code>：从缓存中清除指定持久化对象</li>
  <li>
<code class="highlighter-rouge">clear()</code>：清空缓存中的所有持久化对象</li>
</ul>

<p>其中<code class="highlighter-rouge">evict(object o)</code>方法适用于：</p>

<ol>
  <li>不希望 Session 继续按照对象状态变化来同步更新数据库；</li>
  <li>使用 Hibernate API 批量更新或删除后。当然执行批量更新或者删除最佳的方式是通过 JDBC API 执行相关SQL语句或调用存储过程。</li>
</ol>

<p>通常，<strong>不建议通过上述方法管理一级缓存</strong>，因为其并不能显著提高应用性能。有效的一级缓存管理办法是：<strong>合理的检索策略和检索方式</strong>。如，通过<strong>延迟加载、集合过滤或者投影查询</strong>等手段来节省内存开销。</p>

<h2 id="hibernate-1">Hibernate二级缓存</h2>

<p>Hibernate的二级缓存是进程范围或群集范围的缓存，缓存中存放的是对象的散列数据。二级缓存是可配置的插件，比如：</p>

<ul>
  <li>
<a href="http://ehcache.org/" title="EHCache 主页">EHCache</a> : 可作为进程范围内的缓存，存放数据是物理介质是内存或硬盘，支持Hibernate查询缓存；</li>
  <li>
<a href="http://www.baike.com/wiki/OSCache" title="OSCache 互动百科">OSCache</a> : 可作为进程范围内的缓存，存放数据是物理介质是内存或硬盘，提供了丰富的缓存数据过期策略，支持Hibernate查询缓存；</li>
  <li>
<a href="http://swarmcache.sourceforge.net/" title="SwarmCache 主页">SwarmCache</a> : 可作为群集范围内的的缓存，不支持Hibernate查询缓存；</li>
  <li>
<a href="http://www.jboss.org/jbosscache/" title="JBossCache 主页">JBossCache</a> : 可作为群集范围内的的缓存，支持事务型并发访问策略，支持Hibernate查询缓存。</li>
</ul>

<table class="table table-bordered">
    <caption>各插件支持的并发访问策略</caption>
    <tr>
        <th>缓存插件</th>
        <th>只读型</th>
        <th>非严格读写型</th>
        <th>读写型</th>
        <th>事务型</th>
        <th>Hibernate适配器</th>
    </tr>
    <tr>
        <td>EHCache</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
        <td>否</td>
        <td>org.hibernate.cache.EhCacheProvider</td>
    </tr>
    <tr>
        <td>OSCache</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
        <td>否</td>
        <td>org.hibernate.cache.OSCacheProvider</td>
    </tr>
    <tr>
        <td>SwarmCache</td>
        <td>支持</td>
        <td>支持</td>
        <td>否</td>
        <td>否</td>
        <td>org.hibernate.cache.SwarmCacheProvider</td>
    </tr>
    <tr>
        <td>JBossCache</td>
        <td>支持</td>
        <td>否</td>
        <td>否</td>
        <td>支持</td>
        <td>org.hibernate.cache.TressCacheProvider</td>
    </tr>
    <tfoot>
        <tr><td colspan="6">注：适配器类名基于Hibernate3.jar包</td></tr>
    </tfoot>
</table>

<h3 id="section-10">二级缓存的开启</h3>

<p>这里采用OSCache作为Hibernate cache适配器。</p>

<ol>
  <li>
    <p>配置二级缓存适配器</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> &lt;prop key="hibernate.cache.provider_class"&gt;
     org.hibernate.cache.OSCacheProvider
 &lt;/prop&gt;
</code></pre>
    </div>
  </li>
  <li>
    <p>开启二级缓存</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> &lt;prop key="hibernate.cache.use_second_level_cache"&gt;true&lt;/prop&gt;
</code></pre>
    </div>
  </li>
</ol>

<h2 id="hibernate-2">Hibernate查询缓存</h2>

<p>Hibernate查询缓存依赖于二级缓存。当启用查询缓存后，第一次执行查询语句时，Hibernate会把查询结果保存在二级缓存中。当再次执行查询语句时，只需从缓存中获取查询结果即可。</p>

<p>需要注意的是：<strong>如果查询结果中包含实体，二级缓存只会存放实体的OID，而对于投影查询，二级缓存则会存放所有数值</strong>。</p>

<p>查询缓存适用于以下场合：</p>

<ul>
  <li>经常使用的查询语句</li>
  <li>很少对于查询语句关联的数据库数据进行插入、删除和更新操作。</li>
</ul>

<h3 id="section-11">查询缓存的配置</h3>

<ol>
  <li>配置二级缓存</li>
  <li>
    <p>在Hibernate中配置</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> &lt;prop key="hibernate.cache.use_query_cache"&gt;true&lt;/prop&gt;
</code></pre>
    </div>
  </li>
  <li>调用<code class="highlighter-rouge">Query</code>,<code class="highlighter-rouge">Criteria</code>接口的<code class="highlighter-rouge">setCacheable()</code>方法</li>
</ol>

<p><strong>只有当以上三个工作都做了，查询缓存才会生效！</strong></p>

<h2 id="section-12">与缓存有关的注解</h2>

<h3 id="entity">@Entity</h3>

<p>这里的<code class="highlighter-rouge">@Entity</code>是指来自  persistence.jar 包的<code class="highlighter-rouge">@javax.persistence.Entity</code>。 当使用该注解持久化一个实体时，Hibernate会将该实体存放在一级缓存（Session）中。</p>

<p>默认情况下，实体不是二级缓存的一部分。通常不建议这么做，但你可以通过在你的持久化配置文件中重写 shared-cache-mode 或者使用 javax.persistence.sharedCache.mode 属性来改变默认情况。可能的值有：</p>

<ol>
  <li>
    <p><strong>ENABLE_SELECTIVE</strong>: 实体不被缓存，除非明确的被标记为可被缓存。该值为默认值.言下之意就是完全禁止实体二级缓存。</p>
  </li>
  <li>
    <p><strong>DISABLE_SELECTIVE</strong>: 实体被缓存，除非明确的被标记为不可缓存。</p>
  </li>
  <li>
    <p><strong>ALL</strong>: 所有实体被缓存，除非明确的被标记为不可缓存。</p>
  </li>
</ol>

<p>另，<strong>还有一个来自 hibernate-annotations.jar 包的 <a href="http://docs.jboss.org/hibernate/stable/annotations/reference/en/html/entity.html#entity-hibspec-entity">org.hibernate.annotations.Entity</a> 注解，该注解是作为 @javax.persistence.Entity 注解的补充来使用的，其自身不具有持久化类的功能。</strong></p>

<h3 id="cache">@Cache</h3>

<p>来自 hibernate-annotations.jar 包，全称<code class="highlighter-rouge">@org.hibernate.annotations.Cache</code>。该注解可用于类和集合上。</p>

<p><a href="http://docs.jboss.org/hibernate/stable/annotations/reference/en/html/entity.html#d0e2298">@Cache</a>定义了二级缓存策略和缓存范围，定义如下：</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>@Cache(
    CacheConcurrencyStrategy usage(); // 1
    String region() default "";       // 2
    String include() default "all";   // 3
)
</code></pre>
</div>

<ol>
  <li>
<strong>usage</strong>: 当前缓存策略（<strong>NONE, READ_ONLY, NONSTRICT_READ_WRITE, TRANSACTIONAL</strong>）。
    <ul>
      <li>read-only: 只读缓存；</li>
      <li>read-write: 读写缓存；</li>
      <li>nonstrict-read-write: 不严格读写缓存；</li>
      <li>transactional: 事务型缓存；</li>
    </ul>

    <p>具体的使用说明请查看上述的<strong>持久化层缓存的并发访问策略</strong>或者<a href="http://docs.jboss.org/hibernate/orm/3.6/reference/zh-CN/html/performance.html#performance-cache">查看这里</a>。</p>
  </li>
  <li>
    <p><strong>region</strong>: 可选参数。指定二级缓存的区域名，默认为类或者集合的名字</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>
<strong>include</strong>：可选参数（all</td>
          <td>non-lazy）。all 包含所有属性，non-lazy 仅包含非延迟加载的属性。</td>
        </tr>
      </tbody>
    </table>
  </li>
</ol>

<h4 id="section-13">缓存实体</h4>

<div class="highlighter-rouge">
<pre class="highlight"><code>@javax.persistence.Entity
@Table(name = "PROVINCE")
@Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
public class Province(){ // 省份对象
    ...
}
</code></pre>
</div>

<h4 id="section-14">缓存集合</h4>

<div class="highlighter-rouge">
<pre class="highlight"><code>@javax.persistence.Entity
@Cache (usage = CacheConcurrencyStrategy.READ_ONLY)
public class Province {//省份对象
    @OneToMany(fetch = FetchType.LAZY)
    @JoinColumn(name = "cityId")
    @Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
    private Set&lt;City&gt; citys; // 省份对应城市
}
</code></pre>
</div>

<p>此时，在访问<code class="highlighter-rouge">province.citys</code>时，Hibernate只缓存了city的OID,因此在实际的查询过程中还是需要执行</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>select * from city where cityid = ?
</code></pre>
</div>

<p>来访问数据库表的。为了避免该问题，可以为<code class="highlighter-rouge">City</code>对象配置同样的二级缓存。</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>@javax.persistence.Entity
@Table(name = "CITY")
@Cache (usage = CacheConcurrencyStrategy.READ_ONLY)
public class City {
    ...
} // 城市对象
</code></pre>
</div>

<h2 id="section-15">比较完整的例子</h2>

<ol>
  <li>
    <p>xml配置</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> &lt;!-- 缓存适配器 --&gt;
 &lt;prop key="hibernate.cache.provider_class"&gt;
     org.hibernate.cache.OSCacheProvider
 &lt;/prop&gt;
 &lt;!-- 开启查询缓存 --&gt;
 &lt;prop key="hibernate.cache.use_query_cache"&gt;true&lt;/prop&gt;
 &lt;!-- 开启二级缓存 --&gt;
 &lt;prop key="hibernate.cache.use_second_level_cache"&gt;true&lt;/prop&gt;
</code></pre>
    </div>
  </li>
  <li>
    <p>实体配置</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> @javax.persistence.Entity
 @Table(name = "PROVINCE")
 @Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
 public class Province { // 省份对象
     private String pid;
     private String pname;
        
     @OneToMany // 不用lazy加载，一次性全部加载
     @JoinColumn(name = "cid")
     @Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
     private Set&lt;City&gt; citys; // 省份对应城市
        
     // some set or get method
 }
    
 @javax.persistence.Entity
 @Table(name = "CITY")
 @Cache (usage = CacheConcurrencyStrategy.READ_ONLY)
 public class City { // 城市对象
     private String cid;
     private String cname;
        
     // some set or get method
 } 
    
 // DAO.class
 // HQL
 public List&lt;Provice&gt; findAll(){
     Query query = session.createQuery(" from Provice");
     // 设置为true,启动查询缓存
     query.setCacheable(true); 
     List&lt;Provice&gt; list = query.list();
     session.close();
     return list;
 }
    
 // QBC
 public List&lt;Provice&gt; findAll2(){
     Criteria crit = session.createCriteria(Province.class);
     // 设置为true,启动查询缓存
     crit.setCacheable(true);
 	    List&lt;Module&gt; list = crit.list();
     session.close();
     return list;
 }
</code></pre>
    </div>
  </li>
</ol>


        </div>
        <div class="alert alert-info" role="alert">
            <strong>相关阅读：</strong>
            <ul>
                                                                                                           
                 <!--capture的变量均为字符串-->
                <li><a href="/blog/2013/07/07/hibernate-cache/">Hibernate缓存</a></li>
                                                                           
            </ul>
        </div>
    </div>
    <div class="panel-footer">
        <span class="glyphicon glyphicon-calendar"></span>
        
        <a href="/archives/#2013-07">2013年07月07日</a>
        
        <span class="glyphicon glyphicon-user"></span>
         leeyee 
        
        <span class="glyphicon glyphicon-folder-close"></span>
        <a href="/categorys/#hibernate"> hibernate</a>
        
         <span class="glyphicon glyphicon-tags"></span> hibernate,cache 
    </div>
</div>
<div class="panel panel-default">
    <div class="panel-body">
        <div class="pull-right">
	
		<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_24x24">
     <a class="jiathis_button_tsina"></a>
     <a class="jiathis_button_qzone"></a>
     <a class="jiathis_button_tqq"></a>
     <a class="jiathis_button_renren"></a>
     <a class="jiathis_button_t163"></a>
     <a class="jiathis_button_tsohu"></a>
     <a class="jiathis_button_douban"></a>
     <!--<a href="http://www.jiathis.com/share?uid=1785947" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>-->
     <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1354586152725188" charset="utf-8"></script>
<!-- JiaThis Button END -->
	
</div>
        <div>
	
			<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'oxcow'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script');
		dsq.type = 'text/javascript';
		dsq.async = true;
		dsq.src = 'https://a.disquscdn.com/embed.js';
		//dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document
				.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span
	class="logo-disqus">Disqus</span></a>-->
		

	</div>
    </div>
</div>
        </div>
        <div class="col-xs-6 col-md-4 col-lg-4">
            <div class="panel panel-default">
                <div class="panel-body">
                    <a href="/feed.xml"><img src="/img/rss.png" class="self-img-40">RSS 本站</a>
                </div>
            </div>
            <!-- 本站公告 -->
            <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">本站公告</h2>
    </div>
    <div class="panel-body">
        新版页面陆续建设中，敬请期待......
    </div>
</div>
            <!-- Google Adsense -->
            <!--<div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">Google Adsense</h2>
    </div>
    <div class="panel-body">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-3709356780361184"
            data-ad-slot="2345263955"
            data-ad-format="auto"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
</div>
-->
            <!-- 最新文章 -->
            <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">最新文章</h2>
    </div>
    <div class="list-group">
<!--        <a  class="list-group-item active">最新文章</a>-->
        
        <a href="/blog/2016/11/06/stripes-how-to-wizard_forms/" class="list-group-item">Stripes框架如何做系列-向导表单</a>
        
        <a href="/blog/2016/09/15/stripes-how-to-use_defaults_more/" class="list-group-item">Stripes框架如何做系列-更多使用默认配置</a>
        
        <a href="/blog/2016/09/10/stripes-how-to-unit_testing/" class="list-group-item">Stripes框架如何做系列-单元测试</a>
        
        <a href="/blog/2016/08/25/stripes-how-to-state_management/" class="list-group-item">Stripes框架如何做系列-状态管理</a>
        
        <a href="/blog/2016/08/21/stripes-how-to-localization/" class="list-group-item">Stripes框架如何做系列-本地化</a>
        
        <a href="/blog/2016/08/03/stripes-how-to-spring-with-stripes/" class="list-group-item">Stripes框架如何做系列-Spring和Stripes</a>
        
        <a href="/blog/2016/07/22/stripes-how-to-indexed-properties/" class="list-group-item">Stripes框架如何做系列-索引属性</a>
        
        <a href="/blog/2016/07/17/stripes-how-to-layout-reuse/" class="list-group-item">Stripes框架如何做系列-布局复用</a>
        
        <a href="/blog/2016/07/16/stripes-how-to-intercept-execution/" class="list-group-item">Stripes框架如何做系列-拦截器</a>
        
        <a href="/blog/2016/07/13/stripes-how-to-file-uploads/" class="list-group-item">Stripes框架如何做系列-文件上传</a>
        
    </div>
</div>

            <!-- 文章标签 -->
            <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">文章标签</h2>
    </div>
    <div class="list-group">
       <!-- <a  class="list-group-item active">文章标签</a>-->
        
        <a href="/tags#javascript" class="list-group-item">javascript<span class="badge">9</span></a>
        
        <a href="/tags#struts2" class="list-group-item">struts2<span class="badge">1</span></a>
        
        <a href="/tags#jQuery" class="list-group-item">jQuery<span class="badge">4</span></a>
        
        <a href="/tags#spring" class="list-group-item">spring<span class="badge">3</span></a>
        
        <a href="/tags#%E8%AF%91%E6%96%87" class="list-group-item">译文<span class="badge">18</span></a>
        
        <a href="/tags#pl/sql" class="list-group-item">pl/sql<span class="badge">8</span></a>
        
        <a href="/tags#mybatis" class="list-group-item">mybatis<span class="badge">4</span></a>
        
        <a href="/tags#database" class="list-group-item">database<span class="badge">1</span></a>
        
        <a href="/tags#hibernate" class="list-group-item">hibernate<span class="badge">1</span></a>
        
        <a href="/tags#cache" class="list-group-item">cache<span class="badge">1</span></a>
        
        <a href="/tags#git" class="list-group-item">git<span class="badge">2</span></a>
        
        <a href="/tags#java" class="list-group-item">java<span class="badge">1</span></a>
        
        <a href="/tags#awk" class="list-group-item">awk<span class="badge">2</span></a>
        
        <a href="/tags#linux" class="list-group-item">linux<span class="badge">3</span></a>
        
        <a href="/tags#stripes" class="list-group-item">stripes<span class="badge">15</span></a>
        
    </div>
</div>
            <div class="row">
                <div class="col-xs-12 col-md-6 col-lg-6">
                    <!-- 归档 -->
                    <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">归档</h2>
    </div>
    <div class="panel-body">
        <ul class="nav nav-list">
            
            
             
            <li>
<a href="/archives#2016-11">2016-11
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-09">2016-09
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
            
             
            <li>
<a href="/archives#2016-08">2016-08
                
                
                <span class="badge">3</span></a>
            </li>
            
            
            
            
            
            
             
            <li>
<a href="/archives#2016-07">2016-07
                
                
                <span class="badge">9</span></a>
            </li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
             
            <li>
<a href="/archives#2016-04">2016-04
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-03">2016-03
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-02">2016-02
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2016-01">2016-01
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
            
             
            <li>
<a href="/archives#2015-08">2015-08
                
                
                <span class="badge">5</span></a>
            </li>
            
            
            
            
            
            
            
            
            
            
             
            <li>
<a href="/archives#2015-07">2015-07
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2014-05">2014-05
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2013-11">2013-11
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2013-08">2013-08
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2013-07">2013-07
                
                
                <span class="badge">3</span></a>
            </li>
            
            
            
            
            
            
             
            <li>
<a href="/archives#2013-05">2013-05
                
                
                <span class="badge">3</span></a>
            </li>
            
            
            
            
            
            
             
            <li>
<a href="/archives#2012-12">2012-12
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2012-09">2012-09
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2012-05">2012-05
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
            
             
            <li>
<a href="/archives#2011-11">2011-11
                
                
                <span class="badge">5</span></a>
            </li>
            
            
            
            
            
            
            
            
            
            
             
            <li>
<a href="/archives#2011-06">2011-06
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2011-04">2011-04
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2010-04">2010-04
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2009-09">2009-09
                
                
                <span class="badge">1</span></a>
            </li>
            
            
             
            <li>
<a href="/archives#2009-08">2009-08
                
                
                <span class="badge">2</span></a>
            </li>
            
            
            
        </ul>
    </div>
</div>
                </div>
                <div class="col-xs-12 col-md-6 col-lg-6">
                    <!-- 文章分类 -->
                    <div class="panel panel-primary">
    <div class="panel-heading">
        <h2 class="panel-title">文章分类</h2>
    </div>
    <div class="panel-body">
        <ul class="nav nav-list">
            
            <li>
                <a href="/categorys#javascript">javascript<sup style="padding-left: 4px">6</sup></a>
            </li>
            
            <li>
                <a href="/categorys#struts2">struts2<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#spring">spring<sup style="padding-left: 4px">3</sup></a>
            </li>
            
            <li>
                <a href="/categorys#SQL">SQL<sup style="padding-left: 4px">8</sup></a>
            </li>
            
            <li>
                <a href="/categorys#jQuery">jQuery<sup style="padding-left: 4px">3</sup></a>
            </li>
            
            <li>
                <a href="/categorys#mybatis">mybatis<sup style="padding-left: 4px">4</sup></a>
            </li>
            
            <li>
                <a href="/categorys#database">database<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#hibernate">hibernate<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#git">git<sup style="padding-left: 4px">2</sup></a>
            </li>
            
            <li>
                <a href="/categorys#java">java<sup style="padding-left: 4px">1</sup></a>
            </li>
            
            <li>
                <a href="/categorys#%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80">脚本语言<sup style="padding-left: 4px">2</sup></a>
            </li>
            
            <li>
                <a href="/categorys#%E5%85%B6%E4%BB%96">其他<sup style="padding-left: 4px">3</sup></a>
            </li>
            
            <li>
                <a href="/categorys#stripes">stripes<sup style="padding-left: 4px">15</sup></a>
            </li>
            
        </ul>
    </div>
</div>
                </div>
            </div>
        </div>
    </div>
</div>
<hr>
<footer>
    <p class="text-center">©2016 by Leeyee, All Rights Reserved</p>
</footer>
<!--<script type="text/javascript" src="/js/MathJax.js"></script>-->
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
    !window.jQuery && document.write('<script src="/js/jquery-1.11.1.min.js"><\/script>');
</script>
<script type="text/javascript" src="/js/common.js"></script>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="http://apps.bdimg.com/libs/html5shiv/r29/html5.min.js"></script>
<script src="http://apps.bdimg.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<div id="totop" class="toTop" style="display: block; opacity: 1;">
    <button type="button" class="btn btn-info btn-lg">Top<span class="glyphicon glyphicon-plane"></span></button>
</div>
</body>
</html>
